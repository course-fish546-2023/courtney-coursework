---
title: "blast"
output: html_document
date: "2023-03-30"
---

#Download Software


Will need this later on..

```{r}
library(tidyverse)
```





Getting BLAST

```{bash}
mkdir /home/jovyan/applications
cd /home/jovyan/applications
curl -O https://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/LATEST/ncbi-blast-2.13.0+-x64-linux.tar.gz
```


unzipping..


```{bash}
#unzip the file
cd /home/jovyan/applications
tar -xf ncbi-blast-2.13.0+-x64-linux.tar.gz
```


Lets see if blast works!

```{bash}
~/applications/ncbi-blast-2.13.0+/bin/blastx -h
```


Need to get uniprot swiss-prot fasta to make database.

```{bash}
cd ../data
curl -O https://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/complete/uniprot_sprot.fasta.gz
mv uniprot_sprot.fasta.gz uniprot_sprot_r2023_01.fasta.gz
gunzip -k uniprot_sprot_r2023_01.fasta.gz

```


Did that work? 
```{bash}
ls ../data
```


# Making a blast database

```{bash}
~/applications/ncbi-blast-2.13.0+/bin/makeblastdb \
-in ../data/uniprot_sprot_r2023_01.fasta \
-dbtype prot \
-out ../blastdb/uniprot_sprot_r2023_01
```


# Getting an unknown Query

```{bash}
curl https://eagle.fish.washington.edu/cnidarian/Ab_4denovo_CLC6_a.fa \
-k \
> ../data/Ab_4denovo_CLC6_a.fa
```



Checking it out 

```{bash}
head ../data/Ab_4denovo_CLC6_a.fa
echo "How many sequences are there?"
grep -c ">" ../data/Ab_4denovo_CLC6_a.fa
```


# Running Blastx

```{bash}
~/applications/ncbi-blast-2.13.0+/bin/blastx \
-query ../data/Ab_4denovo_CLC6_a.fa \
-db ../blastdb/uniprot_sprot_r2023_01 \
-out ../output/Ab_4-uniprot_blastx.tab \
-evalue 1E-20 \
-num_threads 20 \
-max_target_seqs 1 \
-outfmt 6
```

Lets have a quick look

```{bash}
head -2 ../output/Ab_4-uniprot_blastx.tab
wc -l ../output/Ab_4-uniprot_blastx.tab
```


CS: I am stuck here... keep getting an error (tr: write error: Broken pipe)

SR: no isssue for me

```{bash}
tr '|' '\t' < ../output/Ab_4-uniprot_blastx.tab | head -2
```



CS : the chunk below won't run (doesn't even show errors--it just buffers breifly)

SR : no problem for me...
```{bash}
tr '|' '\t' < ../output/Ab_4-uniprot_blastx.tab \
> ../output/Ab_4-uniprot_blastx_sep.tab
```



#this says that in file(file, "rt") that it cannot open this file (no file/directory)
#not sure why it says this becuase this exact file is in my output folder

SR - this needs to be a chunk..
see also https://github.com/course-fish546-2023/assistance/issues/6#issuecomment-1491249160

```{r}
bltabl <- read.csv("../output/Ab_4-uniprot_blastx_sep.tab", sep = '\t', header = FALSE)
```



#same error message as above 
sr:fixed

```{r}
spgo <- read.csv("../data/uniprot_sprot_r2023_01.fasta", sep = '\t', header = TRUE)
```


```{r}
str(spgo)
```
